<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>KGP Connect - Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; font-family: Arial, sans-serif; }
    .navbar-custom { display: flex; justify-content: space-between; align-items: center; background-color: #007bff81; color: white; padding: 15px 30px; border-radius: 8px; margin-bottom: 30px; }
    .navbar-custom:hover {background-color: #007bff; box-shadow: 0 0 64px #74b7ff; transition: 0.5s;}
    .navbar-custom .center { font-weight: bold; font-size: 1.3rem; }
    .btn-custom { background-color: rgba(255, 255, 255, 0.8); color: #007bff; border-radius: 20px; border: none; padding: 6px 16px; font-weight: bold; transition: 0.2s; }
    .btn-custom:hover { background-color: #e2e6ea; color: #0056b3; box-shadow: 0 0 32px white;}

    .modal { display: none; position: fixed; z-index: 1000; padding-top: 60px; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
    .modal-content { background-color: #ffffff84; margin: auto; padding: 20px; border-radius: 12px; width: 90%; max-width: 600px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative; }
    #close { position: absolute; right: 15px; top: 10px; font-size: 28px; font-weight: bold; cursor: pointer; color: #888; }
    #close:hover { color: #000; }

    .interests-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 8px; margin-top: 10px; margin-bottom: 15px; }
    .interest-box { background: #f1f3f46d; border-radius: 8px; padding: 6px 8px; transition: 0.2s; font-size: 14px; cursor: pointer; text-align: center; }
    .interest-box.selected { background: #007bff; color: white; }

    .interest-tags { margin-top: 15px; }
    .interest-tags span { display: inline-block; background-color: #007bff; color: white; padding: 5px 10px; border-radius: 15px; margin: 3px 3px 3px 0; font-size: 0.85rem; }

    #save-interests { margin-top: 10px; }
  </style>
</head>
<body style="background-image: url(/static/IITKGP.jpg); background-size: cover;">
  <div class="navbar-custom">
    <div class="left">Hi, {{ user.name }}</div>
    <div class="center">Welcome to <b>KGP Connect</b></div>
    <div class="right">
      <button id="interest-btn" class="btn-custom">My Interests</button>
      <a href="/logout" class="btn btn-danger btn-sm ms-2">Logout</a>
    </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-md-8">
        <div class="card shadow mb-3">
          <div class="card-body">
            <h5 class="card-title">Your Feed</h5>
            <p class="card-text">This is where posts or updates from your friends will appear.</p>
          </div>
        </div>

        <div class="card shadow mb-3">
          <div class="card-body">
            <h5 class="card-title">Connect with Others</h5>
            <p class="card-text">Find other students on the platform and start a conversation.</p>
            <a href="/users" class="btn btn-success me-2">Find Users</a>
            <a href="/search" class="btn btn-primary">Search by Interests</a>
          </div>
        </div>
        
      <div class="col-md-4">
        <div class="card shadow mb-3">
          <div class="card-body">
            <h5 class="card-title">Quick Interests</h5>
            <div class="interest-tags">
              {% set selected_interests = user.interests.split(',')|map('trim')|list if user.interests else [] %}
              {% for interest in selected_interests %}
                {% if interest %}
                  <span>{{ interest }}</span>
                {% endif %}
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="interest-modal" class="modal">
    <div class="modal-content">
      <span id="close">&times;</span>
      <h4>Select Your Interests</h4>
      <div class="interests-container">
        {% set all_interests = [
          "Watching Movies","Watching Anime","Playing Cricket","Playing Football","Playing Tennis",
          "Gym & Fitness","Running / Jogging","Badminton","Cycling","Hiking / Trekking",
          "Gaming","Reading Books","Writing","Music Listening","Singing / Instrument",
          "Dancing","Photography","Art & Design","Cooking / Baking","Volunteering",
          "Tech / Coding","AI & ML","Data Science","Startups","Finance & Investing",
          "Philosophy","Meditation / Yoga","Debating","Movies Discussion","Carrom / Chess"
        ] %}
        {% set selected_interests = user.interests.split(',')|map('trim')|list if user.interests else [] %}
        {% for interest in all_interests %}
          <div class="interest-box {% if interest in selected_interests %}selected{% endif %}" data-interest="{{ interest }}">{{ interest }}</div>
        {% endfor %}
      </div>
      <button id="save-interests" class="btn btn-primary w-100">Save</button>
    </div>
  </div>

  <script>
    const modal = document.getElementById('interest-modal');
    const btn = document.getElementById('interest-btn');
    const span = document.getElementById('close');
    btn.onclick = () => modal.style.display = 'block';
    span.onclick = () => modal.style.display = 'none';
    window.onclick = e => { if (e.target == modal) modal.style.display = 'none'; }

    const interestBoxes = document.querySelectorAll('.interest-box');
    interestBoxes.forEach(box => {
      box.addEventListener('click', () => {
        box.classList.toggle('selected');
      });
    });

    document.getElementById('save-interests').addEventListener('click', () => {
      const selected = [];
      interestBoxes.forEach(box => {
        if (box.classList.contains('selected')) {
          selected.push(box.dataset.interest);
        }
      });

      fetch('/update_interests', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({interests: selected}),
        credentials: 'same-origin' // Important: sends cookies with the request
      }).then(response => {
        if (response.ok) {
            window.location.reload();
        } else {
            alert("Failed to save interests.");
        }
      });
    });
  </script>
</body>
</html>